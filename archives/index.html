<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://ncthis.github.io/blog/blog/archives/">
<meta property="og:site_name" content="Hexo">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/blog/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://ncthis.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/06/12/hello-world/" class="article-date">
  <time datetime="2014-06-12T09:01:24.000Z" itemprop="datePublished">Jun 12 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/06/12/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">trobuleshooting</a> or you can ask me on <a href="https://github.com/tommy351/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2>
<h3 id="Create_a_new_post">Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$ hexo new <span class="string">"My New Post"</span>
</pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$ hexo server
</pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$ hexo generate
</pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$ hexo deploy
</pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ncthis.github.io/blog/2014/06/12/hello-world/" data-id="fwamoyuiplgvi7xp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Creating-a-HTTPS-proxy-in-Nodejs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/10/07/Creating-a-HTTPS-proxy-in-Nodejs/" class="article-date">
  <time datetime="2013-10-07T09:05:15.000Z" itemprop="datePublished">Oct 7 2013</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/10/07/Creating-a-HTTPS-proxy-in-Nodejs/">Creating a HTTPS proxy in Node.js</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently, I needed to mock a dev box to act as the production environment to do some debugging on a Node.js express web app. The problem was that the calls that are received by the said dev box are all HTTPS, (hence received on port 443) and in the local environment, Node is not configured to run on HTTPS, and not on port 80 or 443.</p>
<p><strong>Quick and Dirty solution is to:</strong><br>alter the Node server to start on port 443, after giving a fake HTTPS key and a certificate.</p>
<figure class="highlight Javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">HttpServer</span><span class="params">(handlers)</span> {</span>
  <span class="comment">// this is a fake key and a certificate</span>
  <span class="keyword">var</span> options = {
    key: fs.readFileSync(<span class="string">'cert/key.pem'</span>),
    cert: fs.readFileSync(<span class="string">'cert/key-cert.pem'</span>)
  }

  <span class="keyword">this</span>.handlers = handlers;
  <span class="keyword">this</span>.server = https.createServer(options, <span class="keyword">this</span>.handleRequest_.bind(<span class="keyword">this</span>));
}

HttpServer.prototype.start = <span class="function"><span class="keyword">function</span><span class="params">(port)</span> {</span>
  <span class="keyword">this</span>.port = port;
  <span class="keyword">this</span>.server.listen(<span class="number">443</span>, <span class="string">'example.com'</span>); <span class="comment">// 443 because of HTTPS</span>
  util.puts(<span class="string">'Server started successfully...'</span>);
};
</pre></td></tr></table></figure>

<p>and of course, doing this would require you start node as <code>su</code>, thereby rendering your already set environment variable useless - if you’re into that kind of a thing for setting up your <code>NODE_ENV</code> and <code>PORT</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="built_in">sudo</span> node app.js
</pre></td></tr></table></figure>

<p>I honestly, can’t live with this approach, because we’re doing modifications to the app code and running Node on sudo, which is well.. ugly.</p>
<p><strong>Doing it the right way</strong><br>What we really need is a middleman to listen to 443 as a HTTPS proxy and redirect that traffic to a blissfully oblivious Node server running on 8080 or whatever, with no HTTPS configuration or whatever. To accomplish this, we’ll use Nodejitsu’s excellent <a href="https://github.com/nodejitsu/node-http-proxy" target="_blank" rel="external">node-http-proxy</a>.</p>
<p>First, we’ll need a HTTPS key and a certificate. You can create a <a href="https://devcenter.heroku.com/articles/ssl-certificate-self" target="_blank" rel="external">self-signed HTTPS certificate</a> and use it for this purpose.</p>
<figure class="highlight Javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="keyword">var</span> options = {
  https: {
    key: fs.readFileSync(<span class="string">'key.pem'</span>),
    cert: fs.readFileSync(<span class="string">'key-cert.pem'</span>)
  }
};
</pre></td></tr></table></figure>

<p>Then we’ll need to have the target server ready. My Node.js app runs on <code>localhost:8080</code>, so this will do:</p>
<figure class="highlight Javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="keyword">var</span> proxy = <span class="keyword">new</span> httpProxy.HttpProxy({
  target: {
    host: <span class="string">'127.0.0.1'</span>,
    port: <span class="number">8080</span>
  }
});
</pre></td></tr></table></figure>

<p>Finally of course, we’ll create the proxy server and put everything together.</p>
<figure class="highlight Javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>https.createServer(options.https, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span>
    console.log(<span class="string">'Proxying https request at %s'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>());
    proxy.proxyRequest(req, res);
  }).listen(<span class="number">443</span>, <span class="function"><span class="keyword">function</span><span class="params">(err)</span> {</span>
    <span class="keyword">if</span> (err)
      console.log(<span class="string">'Error creating https proxy '</span>);
	console.log(<span class="string">'Created https proxy. Forwarding requests from %s to %s:%s'</span>, <span class="string">'443'</span>, proxy.target.host, proxy.target.port);
});
</pre></td></tr></table></figure>

<p>Of course, you can <code>console.log</code> the <code>req</code> object for enhanced debugging. Since we’re running the node on 443, we will need to start the proxy with sudo. Otherwise, you’ll encounter an <code>EACCESS</code> error.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="built_in">sudo</span> node proxy.js
</pre></td></tr></table></figure>

<p>I have created a gist of this example that supports both HTTP and HTTPS <a href="https://gist.github.com/nadeeshacabral/6863947" target="_blank" rel="external">right here</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ncthis.github.io/blog/2013/10/07/Creating-a-HTTPS-proxy-in-Nodejs/" data-id="msi477dzu9bjyujy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Nodejs,-devops/">Node.js, devops</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Nodejs,-devops/">Node.js, devops</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/Nodejs,-devops/" style="font-size: NaNpx;">Node.js, devops</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2014/06">June 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2013/10">October 2013</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2014/06/12/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/blog/2013/10/07/Creating-a-HTTPS-proxy-in-Nodejs/">Creating a HTTPS proxy in Node.js</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 John Doe<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script type="text/javascript" src="/blog/js/script.js"></script>
  </div>
</body>
</html>